<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>OpenSecAI - Scanner</title>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center py-10">
  <div class="w-full max-w-4xl bg-gray-800 p-6 rounded-xl shadow-md">
    <h1 class="text-3xl font-bold text-teal-400 text-center mb-4">üîç OpenSecAI Dashboard</h1>
    <p class="text-gray-300 text-center mb-6">Descubra ativos, servi√ßos e vulnerabilidades</p>

    <div class="flex gap-2">
      <input
        id="target"
        type="text"
        placeholder="Digite alvo ou rede (ex: 192.168.0.1 ou 10.0.0.0/24)"
        class="flex-grow px-4 py-2 rounded-lg bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-teal-400 transition"
      />
      <button
        id="scanBtn"
        class="px-4 py-2 bg-teal-500 hover:bg-teal-400 rounded-lg text-white font-semibold transition duration-200"
      >
        Iniciar Scan
      </button>
    </div>

    <div id="loading" class="text-teal-400 mt-4 hidden">üîÑ Escaneando... aguarde...</div>
    <div id="dashboard" class="mt-8 space-y-6"></div>
  </div>

  <script>
    const scanBtn = document.getElementById("scanBtn");
    const targetInput = document.getElementById("target");
    const dashboard = document.getElementById("dashboard");
    const loading = document.getElementById("loading");

    function renderResult(data) {
      dashboard.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        dashboard.innerHTML = "<p class='text-gray-300 text-center'>Nenhum ativo encontrado.</p>";
        return;
      }

      data.forEach(host => {
        const hostCard = document.createElement("div");
        hostCard.className = "bg-gray-700 p-4 rounded-lg shadow-md";

        hostCard.innerHTML = `
          <h2 class="text-xl font-bold text-teal-300">üñ•Ô∏è ${host.host}</h2>
          ${host.mac ? `<p class="text-gray-400">MAC: ${host.mac}</p>` : ""}
          ${host.os ? `<p class="text-gray-400 mb-2">Sistema: ${host.os}</p>` : ""}
          <div class="overflow-auto">
            <table class="w-full mt-2 text-sm text-left text-gray-200 border-t border-gray-600">
              <thead class="text-gray-400">
                <tr>
                  <th class="py-1">Porta</th>
                  <th>Servi√ßo</th>
                  <th>Vers√£o</th>
                  <th>CVEs</th>
                </tr>
              </thead>
                <tbody>
                  ${(host.ports || []).map(p => `
                    <tr class="border-t border-gray-600">
                      <td class="py-1">${p.port}/${p.protocol}</td>
                      <td>${p.service}</td>
                      <td>${p.version || "‚Äî"}</td>
                      <td>
                        ${(p.cves && p.cves.length > 0) ? `
                          <ul class="list-disc list-inside space-y-1">
                            ${p.cves.map(cve => `
                              <li>
                                <a href="${cve.link}" target="_blank" class="text-teal-400 hover:underline">${cve.id}</a>
                                <span class="text-yellow-400 ml-1 text-xs">[CVSS: ${cve.cvss}]</span>
                                <div class="text-gray-400 text-xs">${cve.desc}</div>
                              </li>
                            `).join("")}
                          </ul>
                        ` : "‚Äî"}
                      </td>
                    </tr>
                  `).join("")}
                </tbody>
            </table>
          </div>
        `;

        dashboard.appendChild(hostCard);
      });
    }

    scanBtn.addEventListener("click", () => {
      const target = targetInput.value.trim();
      if (!target) {
        alert("Por favor, informe um alvo v√°lido.");
        return;
      }

      scanBtn.disabled = true;
      scanBtn.textContent = "Processando...";
      loading.classList.remove("hidden");
      dashboard.innerHTML = "";

      fetch("/recon", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ target })
      })
        .then(async res => {
          if (!res.ok) {
            throw new Error(await res.text());
          }
          return res.json();
        })
        .then(renderResult)
        .catch(err => {
          dashboard.innerHTML = `<p class='text-red-400 text-center'>Erro: ${err.message}</p>`;
        })
        .finally(() => {
          scanBtn.disabled = false;
          scanBtn.textContent = "Iniciar Scan";
          loading.classList.add("hidden");
        });
    });
  </script>
</body>
</html>
